#!/bin/bash

# Check if two arguments are provided
if [ "$#" -ne 2 ]; then
    echo "Usage: $0 <source_dir> <target_dir>"
    exit 1
fi

SOURCE_DIR="$1"
TARGET_DIR="$2"

# Find all TIFF files in the source directory
find "$SOURCE_DIR" -type f -name "*.tif" | while read tif_file; do
    # Compute the corresponding WebP file path
    webp_file="${tif_file/$SOURCE_DIR/$TARGET_DIR}"
    webp_file="${webp_file%.tif}.webp"

    # Create the target directory if it doesn't exist
    mkdir -p "$(dirname "$webp_file")"

    # Convert the TIFF to WebP with lossless compression
    convert "$tif_file" -define webp:lossless=true "$webp_file"
done


